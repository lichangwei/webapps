/*! gesture @version 1.0.2 2013-05-29 */
/* @author: Li Chang Wei <lichangwei@love.com> */
/* @see https://github.com/lichangwei/gesture.git */
(function(){"use strict";function t(t,e){m.prototype[t]=function(n,r,a,o){"string"!=typeof n&&(o=a,a=r,r=n,n=void 0),"object"!=typeof r&&(o=a,a=r,r=void 0);for(var i=n?d(t,n,a):a,u=0;this.elems.length>u;u++){var s=this.elems[u];e&&e.call(s,t),s.addEventListener(t,i,!1);var c=_[s._gesture_id];c.push({type:t,selector:n,namespace:o,callback:i,original:a,data:r}),c._counter[t]=(c._counter[t]||0)+1}return this}}function e(t){t._gesture_id=++T;var e,r,u,s,c,d,l,p,g,v,h=_[t._gesture_id]=[],m=h._counter={},b=0,E={targets:[]};t.addEventListener(D,function(t){b=1,s=e=t.timeStamp,c=r=a(t),d=u=o(t);for(var i in y){var l=y[i];if("function"==typeof l.touchstart&&n(l.types,m)){var p=l.touchstart.call(this,t,E,e,r,u);if(p===!1)break}}},!1),t.addEventListener(L,function(t){if(b){s=t.timeStamp,c=a(t),d=o(t),l=s-e,p=c-r,g=d-u;for(var i in y){var f=y[i];if("function"==typeof f.touchmove&&n(f.types,m)){var v=f.touchmove.call(this,t,E,s,c,d,l,p,g);if(v===!1)break}}}},!1),t.addEventListener(S,function(t){if(b){s=t.timeStamp,l=s-e,p=c-r,g=d-u,v=Math.sqrt(p*p+g*g);for(var a in y){var o=y[a];if("function"==typeof o.touchend&&n(o.types,m)){var i=o.touchend.call(this,t,E,s,c,d,l,p,g,v);if(i===!1)break}}b=0}},!1),t.addEventListener(X,function(){b=0},!1),t.addEventListener("touchcancel",function(){b=0},!1),t.addEventListener(Y,function(t){b=0;for(var e in y){var r=y[e];if("function"==typeof r.gesturestart&&n(r.types,m)){var a=r.gesturestart.call(this,t,E);if(a===!1)break}}},!1),t.addEventListener(M,function(t){b=0;for(var e in y){var r=y[e];if("function"==typeof r.gesturechange&&n(r.types,m)){var a=r.gesturechange.call(this,t,E);if(a===!1)break}}},!1),t.addEventListener(P,function(t){b=0;for(var e in y){var r=y[e];if("function"==typeof r.gestureend&&n(r.types,m)){var a=r.gestureend.call(this,t,E);if(a===!1)break}}},!1),w&&!x&&function(){var e,n,r;t.addEventListener(D,function(t){2>t.touches.length||(e=i(t),r=0,f(Y,t,{scale:1,rotation:r}))},!1),t.addEventListener(L,function(t){if(!(2>t.touches.length)&&e){n=i(t);var a=n.angle-e.angle;r=a,f(M,t,{scale:n.distance/e.distance,rotation:a})}},!1),t.addEventListener(S,function(t){t.touches.length>0||e&&(f(P,t,{scale:n.distance/e.distance,rotation:r}),e=n=0)},!1)}()}function n(t,e){for(var n=0;t.length>n;n++)if(e[t[n]]>0)return!0;return!1}function r(t){if("undefined"!=typeof jQuery&&t instanceof jQuery?t=t.get():t instanceof HTMLElement||t===document?t=[t]:"string"==typeof t&&(t=document.querySelectorAll(t)),t instanceof NodeList||t instanceof HTMLCollection){for(var e=[],n=0;t.length>n;n++)e.push(t[n]);t=e}return t}function a(t){return t.pageX||t.clientX||(t.touches&&t.touches[0]?t.touches[0].pageX:0)||(t.changedTouches&&t.changedTouches[0]?t.changedTouches[0].pageX:0)}function o(t){return t.pageY||t.clientY||(t.touches&&t.touches[0]?t.touches[0].pageY:0)||(t.changedTouches&&t.changedTouches[0]?t.changedTouches[0].pageY:0)}function i(t){var e=t.touches[0],n=t.touches[1],r=[e.pageX,e.pageY],a=[n.pageX,n.pageY];return{distance:s(r,a),angle:u(r,a)}}function u(t,e){var n=t[0]-e[0],r=t[1]-e[1];return 0===n?0===r?0:r>0?90:-90:180*Math.atan(r/n)/Math.PI}function s(t,e){return Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2))}function c(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])}function d(t,e,n){var r=n._g_cbs=n._g_cbs||{},a=l(t,e);return r[a]||(r[a]=function(t){var r=this.querySelectorAll(e);if(0!==r.length){for(var a=[],o=0;r.length>o;o++)a.push(r[o]);for(var i,u=t.targets||t.target&&[t.target]||t.eventTarget&&[t.eventTarget],o=0;u&&u.length>o;o++){for(var s=u[o];s!==this;s=s.parentNode){if(!s)return;if(a.indexOf(s)>=0)break}if(s===this)return;if(i&&i!==s)return;i=s}t.isSimulated&&(t.target=i),i&&n.call(i,t)}}),r[a]}function l(t,e){return t+"-"+e}function p(t,e,n){c(this,n),this.type=t,this.originalEvent=e,this.target=e.target||e.currentTarget||document,this.currentTarget=n.eventTarget||e.currentTarget||document,this.pageX=a(e),this.pageY=o(e)}function f(t,e,n){if(n=n||{},e=e||{},E){var r=document.createEvent("CustomEvent");r.initCustomEvent(t,n.canBubble,!0,1)}else{var r=document.createEvent("UIEvent");r.initUIEvent(t,n.canBubble,!0,document.defaultView,1)}c(r,n),r.originalEvent=e,r.isSimulated=!0,r.px=a(e),r.py=o(e);var i=n.eventTarget||e.currentTarget;(i||document).dispatchEvent(r)}function g(){return!0}function v(){return!1}function h(t){t.preventDefault()}var m=window.g=function(t){if(!(this instanceof m))return new m(t);var n=this.elems=r(t);if(n&&0!==n.length)for(var a=0;n.length>a;a++)n[a]._gesture_id||e(n[a])};m.version="1.0",m.prototype.on=function(t,e,n,r){var a=this;if(t.search(/\s/)>=0)return t.replace(/\S+/g,function(t){a.on(t,e,n,r)}),a;if(-1!==t.indexOf(".")){var o=t.split(".");t=o[0];var i=o[1]}var u=[];return e&&u.push(e),n&&u.push(n),r&&u.push(r),i&&u.push(i),a[t].apply(a,u),this},m.prototype.off=function(t,e,n){var r=this;if("function"==typeof e&&(n=e,e=null),t.search(/\s/)>=0)return t.replace(/\S+/g,function(t){r.off(t,e,n)}),r;if(-1!==t.indexOf(".")){var a=t.split(".");t=a[0];var o=a[1]}for(var i=0;this.elems.length>i;i++){var u=this.elems[i],s=_[u._gesture_id];if(s&&0!==s.length)for(var c=s.length-1;c>=0;c--){var d=s[c];t&&t!==d.type||e&&e!==d.selector||o&&o!==d.namespace||n&&n!==d.original||(u.removeEventListener(d.type,d.callback),s.splice(c,1),s._counter[d.type]--)}}return this},m.prototype.trigger=function(t){for(var e=0;this.elems.length>e;e++)f(t,null,{eventTarget:this.elems[e],canBubble:!0});return this},m.register=function(e,n,r){if(y[e])console.error('"'+e+'" cannot be regiested twice.');else{y[e]=n;for(var a=n.types=e.split(/\s/),o=0;a.length>o;o++)t(a[o],r)}return this},m.unregister=function(t){delete y[t],t=t.split(/\s/);for(var e=0;t.length>e;e++)delete m.prototype[t[e]];return this},m.opt=function(t,e){if("string"==typeof t)return void 0===e?b[t]:b[t]=e;for(var n in t)b[n]=t[n]},m.createEvent=function(t,e,n){n=n||{},e=e||{};for(var r=new p(t,e,n),a=r.currentTarget,o=a._gesture_id||"",i=_[o]||[],u=0;i.length>u&&!r.isImmediatePropagationStopped();u++){var s=i[u];s.type===t&&(r.data=s.data,s.callback.call(a,r))}return this};var y={},_={},T=0,b={tap_max_distance:30,tap_max_duration:Number.MAX_VALUE,doubletap_max_interval:250,flick_min_x_or_y:30,dragstart_after_touchstart:300,zoomout_max_scale:.83,zoomin_min_scale:1.2},E=!!window.CustomEvent,w="ontouchstart"in document.documentElement,x="ongesturestart"in document.documentElement,D=w?"touchstart":"mousedown",L=w?"touchmove":"mousemove",S=w?"touchend":"mouseup",X=w?"touchleave":"mouseleave",Y="gesturestart",M="gesturechange",P="gestureend";m.register("touchstart touchmove touchend mousedown mousemove mouseup click",{}),m.event={touchstart:D,touchmove:L,touchend:S},m.support={touch:w,gesture:x},m.util={arrayify:r,getPageX:a,getPageY:o,getDistance:s,extend:c,Event:p,preventDefault:h},p.prototype={preventDefault:function(){var t=this.originalEvent;t&&(t.preventDefault?t.preventDefault():t.returnValue=!1)},stopPropagation:function(){var t=this.originalEvent;t&&(t.stopPropagation?t.stopPropagation():t.cancelBubble=!0)},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=g,this.stopPropagation()},isImmediatePropagationStopped:v,isSimulated:!0}})(),function(t){"use strict";function e(e,n,r){var a=r.targets;a.push(n.target),a.length>=2?(clearTimeout(r.timerTapDoubletap),t.createEvent("doubletap",n,{targets:r.targets}),a.length=0):1===a.length&&function(e,n){var r=e.currentTarget;n.timerTapDoubletap=setTimeout(function(){t.createEvent("tap",e,{eventTarget:r,targets:n.targets}),n.targets.length=0},t.opt("doubletap_max_interval"))}(n,r)}t.register("tap doubletap",{touchend:function(n,r,a,o,i,u,s,c,d){d>t.opt("tap_max_distance")||u>t.opt("tap_max_duration")||e(this,n,r)}})}(g),function(t){"use strict";t.opt("tap_max_duration",300),t.register("taphold",{touchstart:function(e,n){var r=e.currentTarget;n.timerTaphold=setTimeout(function(){t.createEvent("taphold",e,{eventTarget:r})},t.opt("tap_max_duration"))},touchmove:function(e,n,r,a,o,i,u,s){var c=Math.sqrt(u*u+s*s);c>t.opt("tap_max_distance")&&clearTimeout(n.timerTaphold)},touchend:function(t,e){clearTimeout(e.timerTaphold)}})}(g),function(t){"use strict";t.register("swipestart swipe swipeend",{touchstart:function(t){t.preventDefault()},touchmove:function(e,n,r,a,o,i,u,s){var c=Math.sqrt(u*u+s*s);!n.isSwipe&&c>=t.opt("tap_max_distance")&&(n.isSwipe=!0,t.createEvent("swipestart",e)),n.isSwipe&&t.createEvent("swipe",e,{deltaX:u,deltaY:s})},touchend:function(e,n,r,a,o,i,u,s){if(n.isSwipe){var c=1e3*(u/i),d=1e3*(s/i);t.createEvent("swipeend",e,{deltaX:u,deltaY:s,speedX:c,speedY:d}),n.isSwipe=!1}}})}(g),function(t){function e(e,i){function u(e){e.preventDefault(),c=t.util.getPageX(e),d=t.util.getPageY(e),l=c-i.startX,p=d-i.startY,m=l+w.left,y=p+w.top,x&&(m=Math.min(m,x.right-w.width),m=Math.max(m,x.left),y=Math.min(y,x.bottom-w.height),y=Math.max(y,x.top),l=m-w.left,p=y-w.top),(g||f).style.top="-10000px",L=r(document.elementFromPoint(c,d)),D.dropable===L.dropable?a("dragover",e,{dataTransfer:h},L):(D.dropable&&a("dragleave",e,{dataTransfer:h},D),L.dropable&&a("dragenter",e,{dataTransfer:h},L),D=L),"copy"===v?(g.style.top=w.top+p+"px",g.style.left=w.left+l+"px"):(f.style.top=E+p+"px",f.style.left=b+l+"px"),t.createEvent("drag",e,{deltaX:l,deltaY:p,targets:[f],eventTarget:i.currentTarget,dataTransfer:h})}function s(e){document.removeEventListener(t.event.touchmove,u),document.removeEventListener(t.event.touchend,s),e.preventDefault(),"copy"===v&&(document.body.removeChild(g),f.style.top=E+p+"px",f.style.left=b+l+"px"),t.createEvent("dragend",e,{deltaX:l,deltaY:p,targets:[f],eventTarget:i.currentTarget,dataTransfer:h}),a("drop",e,{dataTransfer:h},L)}var c,d,l,p,f=n(e,i.currentTarget);if(f&&f.getAttribute("drag")){var g,v=f.getAttribute("drag"),h=new o;i.start=new Date,t.createEvent("dragstart",e,{targets:[f],eventTarget:i.currentTarget,dataTransfer:h});var m,y,_=window.getComputedStyle(f,null),T="absolute"===_.position,b=T?f.offsetLeft:parseInt(_.left,10)||0,E=T?f.offsetTop:parseInt(_.top,10)||0,w=f.getBoundingClientRect(),x=f.getAttribute("container");x&&(x=document.querySelector(x)),x&&(x=x.getBoundingClientRect()),"copy"===v&&(g=f.cloneNode(!0),g.className=f.className,g.style.cssText=f.style.cssText,g.style.position="absolute",g.style.top=w.top+"px",g.style.left=w.left+"px",g.style.opacity="0.5",g.removeAttribute("drag"),document.body.appendChild(g));var D={},L={};document.addEventListener(t.event.touchmove,u,!1),document.addEventListener(t.event.touchend,s,!1)}}function n(t,e){for(var n=t.target;n&&!n.getAttribute("drag")&&n!==e;)n=n.parentNode;return n}function r(t){for(var e,n;t;)!e&&t.getAttribute&&t.getAttribute("dropable")&&(e=t),!n&&t._g_dropable_ancestor&&(n=t),t=t.parentNode;return{dropable:e,ancestor:n}}function a(e,n,r,a){r=r||{},r.targets=[a.dropable],a.dropable&&a.ancestor&&(r.eventTarget=a.ancestor,t.createEvent(e,n,r)),a.dropable&&!a.ancestor&&(r.eventTarget=a.dropable,t.createEvent(e,n,r))}function o(){this.data={}}t.register("dragstart drag dragend",{touchstart:function(n,r,a,o,i){n.preventDefault();var u=r.dragData={};u.currentTarget=n.currentTarget,u.startX=o,u.startY=i,clearTimeout(u.timeout),u.timeout=setTimeout(function(){var r=t.util.getDistance([u.endX,u.endY],[o,i]);r>t.opt("tap_max_distance")||e(n,u)},t.opt("dragstart_after_touchstart"))},touchmove:function(t,e,n,r,a){var o=e.dragData;o&&!o.start&&(o.endX=r,o.endY=a)},touchend:function(t,e){var n=e.dragData;n&&(clearTimeout(e.dragData.timeout),e.dragData=null)}}),t.register("dragenter dragover dragleave drop",{},function(){this._g_dropable_ancestor=!0}),o.prototype={dropEffect:"none",effectAllowed:"",setData:function(t,e){this.data[t]=e},getData:function(t){return this.data[t]},clearData:function(){this.data={}},setDragImage:function(){throw"Unimplemented."},addElement:function(){throw"Unimplemented."}}}(g);
//@ sourceMappingURL=dist/gesture.min.js.map
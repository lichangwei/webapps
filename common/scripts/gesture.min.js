/*! gesture @version 1.0.3 2013-06-15 */
/* @author: Li Chang Wei <lichangwei@love.com> */
/* @see https://github.com/lichangwei/gesture.git */
(function(){"use strict";function t(t,e){h.prototype[t]=function(n,r,a,o){"string"!=typeof n&&(o=a,a=r,r=n,n=void 0),"object"!=typeof r&&(o=a,a=r,r=void 0);for(var i=n?d(t,n,a):a,u=0;this.elems.length>u;u++){var s=this.elems[u];e&&e.call(s,t);for(var c=y[t],l=0;c&&c.length>l;l++)s.addEventListener(c[u],i,!1);var p=_[s._gesture_id];p.push({type:t,selector:n,namespace:o,callback:i,original:a,data:r}),p._counter[t]=(p._counter[t]||0)+1}return this}}function e(t){t._gesture_id=++b;var e,r,u,s,c,d,l,p,g,v,h=_[t._gesture_id]=[],y=h._counter={},T=0,E={targets:[]};t.addEventListener(L,function(t){T=1,s=e=t.timeStamp,c=r=a(t),d=u=o(t);for(var i in m){var l=m[i];if("function"==typeof l.touchstart&&n(l.types,y)){var p=l.touchstart.call(this,t,E,e,r,u);if(p===!1)break}}},!1),t.addEventListener(D,function(t){if(T){s=t.timeStamp,c=a(t),d=o(t),l=s-e,p=c-r,g=d-u;for(var i in m){var f=m[i];if("function"==typeof f.touchmove&&n(f.types,y)){var v=f.touchmove.call(this,t,E,s,c,d,l,p,g);if(v===!1)break}}}},!1),t.addEventListener(S,function(t){if(T){s=t.timeStamp,l=s-e,p=c-r,g=d-u,v=Math.sqrt(p*p+g*g);for(var a in m){var o=m[a];if("function"==typeof o.touchend&&n(o.types,y)){var i=o.touchend.call(this,t,E,s,c,d,l,p,g,v);if(i===!1)break}}T=0}},!1),t.addEventListener(X,function(){T=0},!1),t.addEventListener("touchcancel",function(){T=0},!1),t.addEventListener(P,function(t){T=0;for(var e in m){var r=m[e];if("function"==typeof r.gesturestart&&n(r.types,y)){var a=r.gesturestart.call(this,t,E);if(a===!1)break}}},!1),t.addEventListener(Y,function(t){T=0;for(var e in m){var r=m[e];if("function"==typeof r.gesturechange&&n(r.types,y)){var a=r.gesturechange.call(this,t,E);if(a===!1)break}}},!1),t.addEventListener(M,function(t){T=0;for(var e in m){var r=m[e];if("function"==typeof r.gestureend&&n(r.types,y)){var a=r.gestureend.call(this,t,E);if(a===!1)break}}},!1),x&&!w&&function(){var e,n,r;t.addEventListener(L,function(t){2>t.touches.length||(e=i(t),r=0,f(P,t,{scale:1,rotation:r}))},!1),t.addEventListener(D,function(t){if(!(2>t.touches.length)&&e){n=i(t);var a=n.angle-e.angle;r=a,f(Y,t,{scale:n.distance/e.distance,rotation:a})}},!1),t.addEventListener(S,function(t){t.touches.length>0||e&&(f(M,t,{scale:n.distance/e.distance,rotation:r}),e=n=0)},!1)}()}function n(t,e){for(var n=0;t.length>n;n++)if(e[t[n]]>0)return!0;return!1}function r(t){if("undefined"!=typeof jQuery&&t instanceof jQuery?t=t.get():t instanceof HTMLElement||t===document?t=[t]:"string"==typeof t&&(t=document.querySelectorAll(t)),t instanceof NodeList||t instanceof HTMLCollection){for(var e=[],n=0;t.length>n;n++)e.push(t[n]);t=e}return t}function a(t){return t.pageX||t.clientX||(t.touches&&t.touches[0]?t.touches[0].pageX:0)||(t.changedTouches&&t.changedTouches[0]?t.changedTouches[0].pageX:0)}function o(t){return t.pageY||t.clientY||(t.touches&&t.touches[0]?t.touches[0].pageY:0)||(t.changedTouches&&t.changedTouches[0]?t.changedTouches[0].pageY:0)}function i(t){var e=t.touches[0],n=t.touches[1],r=[e.pageX,e.pageY],a=[n.pageX,n.pageY];return{distance:s(r,a),angle:u(r,a)}}function u(t,e){var n=t[0]-e[0],r=t[1]-e[1];return 0===n?0===r?0:r>0?90:-90:180*Math.atan(r/n)/Math.PI}function s(t,e){return Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2))}function c(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])}function d(t,e,n){var r=n._g_cbs=n._g_cbs||{},a=l(t,e);return r[a]||(r[a]=function(t){var r=this.querySelectorAll(e);if(0!==r.length){for(var a=[],o=0;r.length>o;o++)a.push(r[o]);for(var i,u=t.targets||t.target&&[t.target]||t.eventTarget&&[t.eventTarget],o=0;u&&u.length>o;o++){for(var s=u[o];s!==this;s=s.parentNode){if(!s)return;if(a.indexOf(s)>=0)break}if(s===this)return;if(i&&i!==s)return;i=s}t.isSimulated&&(t.target=i),i&&n.call(i,t)}}),r[a]}function l(t,e){return t+"-"+e}function p(t,e,n){c(this,n),this.type=t,this.originalEvent=e,this.target=e.target||e.currentTarget||document,this.currentTarget=n.eventTarget||e.currentTarget||document,this.pageX=a(e),this.pageY=o(e)}function f(t,e,n){n=n||{},e=e||{};var r;E?(r=document.createEvent("CustomEvent"),r.initCustomEvent(t,n.canBubble,!0,1)):(r=document.createEvent("UIEvent"),r.initUIEvent(t,n.canBubble,!0,document.defaultView,1)),c(r,n),r.originalEvent=e,r.isSimulated=!0,r.px=a(e),r.py=o(e);var i=n.eventTarget||e.currentTarget;(i||document).dispatchEvent(r)}function g(){return!0}function v(){return!1}var h=window.g=function(t){if(!(this instanceof h))return new h(t);var n=this.elems=r(t);if(n&&0!==n.length)for(var a=0;n.length>a;a++)n[a]._gesture_id||e(n[a])};h.version="1.0",h.prototype.on=function(t,e,n,r){var a,o=this;if(t.search(/\s/)>=0)return t.replace(/\S+/g,function(t){o.on(t,e,n,r)}),o;if(-1!==t.indexOf(".")){var i=t.split(".");t=i[0],a=i[1]}var u=[];return e&&u.push(e),n&&u.push(n),r&&u.push(r),a&&u.push(a),o[t].apply(o,u),this},h.prototype.off=function(t,e,n){var r,a=this;if("function"==typeof e&&(n=e,e=null),t.search(/\s/)>=0)return t.replace(/\S+/g,function(t){a.off(t,e,n)}),a;if(-1!==t.indexOf(".")){var o=t.split(".");t=o[0],r=o[1]}for(var i=0;this.elems.length>i;i++){var u=this.elems[i],s=_[u._gesture_id];if(s&&0!==s.length)for(var c=s.length-1;c>=0;c--){var d=s[c];if(!(t&&t!==d.type||e&&e!==d.selector||r&&r!==d.namespace||n&&n!==d.original)){for(var l=y[d.type]||[d.type],p=0;l.length>p;p++)u.removeEventListener(l[p],d.callback,!1);s.splice(c,1),s._counter[d.type]--}}}return this},h.prototype.trigger=function(t){for(var e=0;this.elems.length>e;e++)f(t,null,{eventTarget:this.elems[e],canBubble:!0});return this},h.register=function(e,n,r){if(m[e])console.error('"'+e+'" cannot be regiested twice.');else{n=n||{},m[e]=n;for(var a=n.types=e.split(/\s/),o=0;a.length>o;o++)t(a[o],r)}return this},h.unregister=function(t){delete m[t],t=t.split(/\s/);for(var e=0;t.length>e;e++)delete h.prototype[t[e]];return this},h.enableNativeEvent=function(e,n){return n?"string"==typeof n&&(n=[n]):n=[],-1===n.indexOf(e)&&n.push(e),y[e]=n,t(e),this},h.opt=function(t,e){if("string"==typeof t)return void 0===e?T[t]:T[t]=e;for(var n in t)T[n]=t[n]},h.createEvent=function(t,e,n){n=n||{},e=e||{};for(var r=new p(t,e,n),a=r.currentTarget,o=a._gesture_id||"",i=_[o]||[],u=0;i.length>u&&!r.isImmediatePropagationStopped();u++){var s=i[u];s.type===t&&(r.data=s.data,s.callback.call(a,r))}return r};var m={},y={},_={},b=0,T={tap_max_distance:30,tap_max_duration:Number.MAX_VALUE,doubletap_max_interval:250,flick_min_x_or_y:30,dragstart_after_touchstart:300,zoomout_max_scale:.83,zoomin_min_scale:1.2},E=!!window.CustomEvent,x="ontouchstart"in document.documentElement,w="ongesturestart"in document.documentElement,L=x?"touchstart":"mousedown",D=x?"touchmove":"mousemove",S=x?"touchend":"mouseup",X=x?"touchleave":"mouseleave",P="gesturestart",Y="gesturechange",M="gestureend";h.event={touchstart:L,touchmove:D,touchend:S},h.support={touch:x,gesture:w},h.util={arrayify:r,getPageX:a,getPageY:o,getDistance:s,extend:c,Event:p},p.prototype={preventDefault:function(){this.defaultPrevented=!0;var t=this.originalEvent;t&&t.preventDefault()},stopPropagation:function(){var t=this.originalEvent;t&&t.stopPropagation()},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=g,this.stopPropagation()},isImmediatePropagationStopped:v,isSimulated:!0,defaultPrevented:!1},h.enableNativeEvent("touchstart","mousedown").enableNativeEvent("touchmove","mousemove").enableNativeEvent("touchend","mouseup").enableNativeEvent("click")})(),function(t){"use strict";function e(e,n,r){var a=r.targets;a.push(n.target),a.length>=2?(clearTimeout(r.timerTapDoubletap),t.createEvent("doubletap",n,{targets:r.targets}),a.length=0):1===a.length&&function(e,n){var r=e.currentTarget;n.timerTapDoubletap=setTimeout(function(){t.createEvent("tap",e,{eventTarget:r,targets:n.targets}),n.targets.length=0},t.opt("doubletap_max_interval"))}(n,r)}t.register("tap doubletap",{touchend:function(n,r,a,o,i,u,s,c,d){d>t.opt("tap_max_distance")||u>t.opt("tap_max_duration")||e(this,n,r)}})}(g),function(t){"use strict";t.opt("tap_max_duration",300),t.register("taphold",{touchstart:function(e,n){var r=e.currentTarget;n.timerTaphold=setTimeout(function(){t.createEvent("taphold",e,{eventTarget:r})},t.opt("tap_max_duration"))},touchmove:function(e,n,r,a,o,i,u,s){var c=Math.sqrt(u*u+s*s);c>t.opt("tap_max_distance")&&clearTimeout(n.timerTaphold)},touchend:function(t,e){clearTimeout(e.timerTaphold)}})}(g),function(t){"use strict";t.register("swipestart swipe swipeend",{touchstart:function(t){t.preventDefault()},touchmove:function(e,n,r,a,o,i,u,s){var c=Math.sqrt(u*u+s*s);!n.isSwipe&&c>=t.opt("tap_max_distance")&&(n.isSwipe=!0,t.createEvent("swipestart",e)),n.isSwipe&&t.createEvent("swipe",e,{deltaX:u,deltaY:s})},touchend:function(e,n,r,a,o,i,u,s){if(n.isSwipe){var c=1e3*(u/i),d=1e3*(s/i);t.createEvent("swipeend",e,{deltaX:u,deltaY:s,speedX:c,speedY:d}),n.isSwipe=!1}}})}(g),function(t){function e(e,i){function u(e){e.preventDefault(),e.stopPropagation(),c=t.util.getPageX(e),d=t.util.getPageY(e),l=c-i.startX,p=d-i.startY,m=l+x.left,y=p+x.top,w&&(m=Math.min(m,w.right-x.width),m=Math.max(m,w.left),y=Math.min(y,w.bottom-x.height),y=Math.max(y,w.top),l=m-x.left,p=y-x.top),(g||f).style.top="-10000px",D=r(document.elementFromPoint(c,d)),L.dropable===D.dropable?a("dragover",e,{dataTransfer:h},D):(L.dropable&&a("dragleave",e,{dataTransfer:h},L),D.dropable&&a("dragenter",e,{dataTransfer:h},D),L=D),"copy"===v?(g.style.top=x.top+p+"px",g.style.left=x.left+l+"px"):(f.style.top=E+p+"px",f.style.left=T+l+"px"),t.createEvent("drag",e,{deltaX:l,deltaY:p,targets:[f],eventTarget:i.currentTarget,dataTransfer:h})}function s(e){e.preventDefault(),document.removeEventListener(t.event.touchmove,u,!0),document.removeEventListener(t.event.touchend,s,!1),"copy"===v&&document.body.removeChild(g);var n=a("drop",e,{dataTransfer:h},D);t.createEvent("dragend",e,{deltaX:l,deltaY:p,targets:[f],eventTarget:i.currentTarget,dataTransfer:h});var r=n?n.defaultPrevented:!0;r?"move"===v&&(f.style.top=E+"px",f.style.left=T+"px"):"copy"===v&&(f.style.top=E+p+"px",f.style.left=T+l+"px")}var c,d,l,p,f=n(e,i.currentTarget);if(f&&f.getAttribute("drag")){var g,v=f.getAttribute("drag"),h=new o;i.start=new Date,t.createEvent("dragstart",e,{targets:[f],eventTarget:i.currentTarget,dataTransfer:h});var m,y,_=window.getComputedStyle(f,null),b="absolute"===_.position,T=b?f.offsetLeft:parseInt(_.left,10)||0,E=b?f.offsetTop:parseInt(_.top,10)||0,x=f.getBoundingClientRect(),w=f.getAttribute("container");w&&(w=document.querySelector(w)),w&&(w=w.getBoundingClientRect()),"copy"===v&&(g=f.cloneNode(!0),g.className=f.className,g.style.cssText=f.style.cssText,g.style.position="absolute",g.style.top=x.top+"px",g.style.left=x.left+"px",g.style.opacity="0.5",g.style.pointerEvents="none",g.removeAttribute("drag"),document.body.appendChild(g));var L={},D={};document.addEventListener(t.event.touchmove,u,!0),document.addEventListener(t.event.touchend,s,!1)}}function n(t,e){for(var n=t.target;n&&!n.getAttribute("drag")&&n!==e;)n=n.parentNode;return n}function r(t){for(var e,n;t;)!e&&t.getAttribute&&t.getAttribute("dropable")&&(e=t),!n&&t._g_dropable_ancestor&&(n=t),t=t.parentNode;return{dropable:e,ancestor:n}}function a(e,n,r,a){return a.dropable?(r=r||{},r.targets=[a.dropable],r.eventTarget=a.ancestor||a.dropable,t.createEvent(e,n,r)):void 0}function o(){this.data={}}t.register("dragstart drag dragend",{touchstart:function(n,r,a,o,i){n.preventDefault();var u=r.dragData={};u.currentTarget=n.currentTarget,u.startX=o,u.startY=i,clearTimeout(u.timeout),u.timeout=setTimeout(function(){var r=t.util.getDistance([u.endX,u.endY],[o,i]);r>t.opt("tap_max_distance")||e(n,u)},t.opt("dragstart_after_touchstart"))},touchmove:function(t,e,n,r,a){var o=e.dragData;o&&!o.start&&(o.endX=r,o.endY=a)},touchend:function(t,e){var n=e.dragData;n&&(clearTimeout(e.dragData.timeout),e.dragData=null)}}),t.register("dragenter dragover dragleave drop",{},function(){this._g_dropable_ancestor=!0}),o.prototype={dropEffect:"none",effectAllowed:"",setData:function(t,e){this.data[t]=e},getData:function(t){return this.data[t]},clearData:function(){this.data={}},setDragImage:function(){throw"Unimplemented."},addElement:function(){throw"Unimplemented."}}}(g);
//@ sourceMappingURL=dist/gesture.min.js.map